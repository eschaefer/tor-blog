<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Ahmia search after GSoC development</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/ahmia-search-after-gsoc-development">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">The Tor Project Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
	<a class="page-link" href="/">Blog Home</a>
        <a class="page-link" href="/archive">Archives</a>
	<a class="page-link" href="https://www.torproject.org/about/overview">About Tor</a>
        <a class="page-link donate" href="https://www.torproject.org/donate/donate">Donate</a>

      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <!-- Pages with side column need a 'maincol' class -->
<div class="post maincol">

  <header class="post-header">
    <h1 class="post-title">Ahmia search after GSoC development</h1>
    <p class="post-meta">Sep 7, 2014 • juha</p>
  </header>

  <article class="post-content">
    <p>The Google Summer of Code (GSoC) was an excellent opportunity to improve on the Ahmia search engine. With Google&#39;s stipend and friendly mentoring from The Tor Project, I was able to concentrate on development of my search engine project. Thank you all!</p>

<p><a href="https://trac.torproject.org/projects/tor/wiki/doc/gsoc">GSoC 2014</a> is over, but I am sticking around to continue developing and maintaining Ahmia.</p>

<p>Here is the current status of ahmia after GSoC development:</p>

<h2>Introduction</h2>

<p>Ahmia is <a href="https://github.com/juhanurmi/ahmia/">open-source search engine software</a> for Tor hidden service websites. You can test the running search engine at <a href="https://ahmia.fi/search/">ahmia.fi</a>.</p>

<p>Building a search engine for anonymous web sites running inside the Tor network is an interesting problem. Tor enables web servers to <a href="https://www.torproject.org/docs/hidden-services">hide their location</a> and Tor users can connect to these authenticated hidden services while the server and the user both stay anonymous. However, finding web content is hard without a good search engine and therefore a search engine is needed for the Tor network.</p>

<p>Web search engines are needed to navigate and search the web. There were no search engines for searching hidden service web content, so I decided to build a search engine specially for Tor. I registered ahmia.fi and started development on it as a side project in 2010.</p>

<p>This development involved programming and testing web crawlers, thinking of ways to find hidden service addresses (since the protocol does not allow enumeration), learning about the Tor community, and implementing a filtering policy. Moreover, I implemented <a href="https://ahmia.fi/documentation/">an API</a> that empowers other Tor services that publish content to integrate with Ahmia.</p>

<p>As a result, Ahmia is a working search engine that indexes, searches and catalogs content published on Tor Hidden Services. Furthermore, it is an environment to share meaningful statistics, insights and news about the Tor network itself.</p>

<h2>Interesting Summer of Code</h2>

<p>One of my best memories from the summer is the Tor Project&#39;s Summer 2014 Developers meeting that was hosted by Mozilla in Paris, France. I have always admired the people who are working on the Tor Project.</p>

<p>I also loved the coding itself. Finally I had time to improve the Ahmia search engine and its many features. <a href="https://github.com/juhanurmi/ahmia/commits/master">I did a lot of work</a> and liked it.</p>

<p>Some journalist were very interested in my work: Carola Frediani asked if I could analyze the content of hidden services. I coded a script that fetches every front page&#39;s HTML, I gathered all the keywords, headers and description texts and made a simple word cloud visualization.</p>

<p><img src="https://ahmia.fi/static/visuals/content.png" alt="Hidden website content visualization."></p>

<p>It is a simple way to glance what is published on the hidden websites.</p>

<p>Carola found this data useful and used it in her presentation at <a href="http://www.sotn.it" title="www.sotn.it">www.sotn.it</a> on June 11th.</p>

<h2>Technical design of ahmia</h2>

<p>The Ahmia web service is written using the Django web framework. As a result, the server-side language is Python. On the client-side, most of the pages are plain HTML. There are some pages that require JavaScript, but the search itself works without client-side JavaScript.</p>

<p>The components of Ahmia are:</p>

<ul>
<li>Django front-end site</li>
<li>PostgreSQL database for the site</li>
<li>Custom scripts to download data about hidden services</li>
<li>Django-Haystack connection to Solr database</li>
<li>Apache Solr for the crawled data</li>
<li>OnionBot crawler that gathers data to Solr database</li>
</ul>

<p><img src="https://raw.githubusercontent.com/juhanurmi/ahmia/master/technical_architecture.png" alt="Technical architecture."></p>

<p><a href="https://github.com/juhanurmi/ahmia/blob/master/README.md">See installation and developing tutorial</a></p>

<h2>Search</h2>

<p>The full-text search is implemented using Django-Haystack. The search is using crawled website data that is saved to Apache Solr.</p>

<h2>OnionDir</h2>

<p><a href="https://ahmia.fi/address/">OnionDir</a> is a list of known online hidden service addresses. A separate script gathers this list and fetches information fields from the HTML (title, keywords, description etc.). Furthermore, users can freely edit these fields.</p>

<p>We&#39;ve also started a convention where hidden service admins can add a file to their website, called <a href="https://ahmia.fi/documentation/descriptionProposal/">description.json</a>, to offer an official description of their site in Ahmia.</p>

<p>As a result, this information is shown in <a href="https://ahmia.fi/address/#/search=Description%20downloaded%20directly%20from%20the%20hidden%20service.">the OnionDir page</a> and over 80 domains are already using this method.</p>

<h2>Statistics</h2>

<p>We are gathering statistics from hidden services. As a result, we can represent and share <a href="https://ahmia.fi/documentation/">meaningful data about hidden services</a> and <a href="https://ahmia.fi/stats/viewer">visualize it</a>.</p>

<p>We are gathering three types of popularity data:</p>

<ol>
<li>Tor2web nodes share their visiting statistics to Ahmia</li>
<li>Number of public WWW backlinks to hidden services</li>
<li>Number of clicks in the search results</li>
</ol>

<p>The click counter tells the total number of clicks on a search result in ahmia.fi</p>

<h2>Filtering</h2>

<p>We have decided to filter any sites related to child porn from our search results. Ahmia is removing everything related to these websites. These websites may not be actual child porn sites. They are rather sites where users can post content (forums, file and image uploads etc.) and as the result there have been, momentarily at least, some suspicious content that has not been moderated in a reasonable period of time. Ahmia.fi does not have the time to monitor these sites carefully and we are banning sites from our public index if we see any evidence of child abuse. Of course, the ban is removed if the site itself contacts us and we review the website to be OK.</p>

<p>In practice, Ahmia calculates the MD5 sums of the banned domains for use as a filtering policy. Moreover, we are sharing this list and Tor2web nodes can use the list to filter out pages.</p>

<p>At the moment, there seems to be 1228 hidden website domains online and 7 of them has been filtered because they are possibly sharing child porn content.</p>

<h2>OnionBot</h2>

<p><a href="https://github.com/juhanurmi/ahmia/tree/master/onionbot">OnionBot</a> is a crawler for hidden service websites based on the Scrapy framework. It crawls the Tor network and passes data to the search database. OnionBot requires the Tor software (using Tor2web mode) and Polipo. The results are saved to Apache Solr.</p>

<h2>Apache Solr</h2>

<p>Apache Solr is a popular, open source enterprise search platform. Its major features include powerful full-text search, hit highlighting, faceted search, and near real-time indexing.</p>

<p>The <a href="https://github.com/juhanurmi/ahmia/blob/master/solr/schema.xml">schema.xml</a> file contains all of the details about which fields your documents can contain, and how those fields should be dealt with when adding documents to the index, or when querying those fields.</p>

<h2>Security measures for privacy</h2>

<p>In the software</p>

<ul>
<li>We do not log any IP addresses, see <a href="https://github.com/juhanurmi/ahmia/tree/master/apache2">Apache configuration</a></li>
<li>We are gathering real-time clicks, however, this data is not shown accurately</li>
</ul>

<p>In the host ahmia.fi</p>

<ul>
<li>Backend servers are run separately and they do not have any knowledge about the end-users</li>
<li>All servers are hosted in countries with strong privacy laws. For example, Finland and the Netherlands</li>
<li>Communication between servers is encrypted</li>
<li>Only a few trustworthy people know the locations of the back-end servers and are able to access them</li>
</ul>

<h2>Future work</h2>

<p>GSoC 2014 was fun and productive!</p>

<p>There is a lot more to do. However, I do not have time to do everything myself. Of course, I am coding when I have time and maintaining the search engine.</p>

<p>In addition, I am going to write a scientific article about the implementation.</p>

<p>Is there anyone who would be interested in developing Ahmia.fi?</p>

<p>Is anyone familiar with Solr and would know how to tweak it for full text search?</p>

<p>Furthermore, any kind of help would be most welcome. There are always Linux admin duties, HTML/CSS design, bug fixing, Django development, etc...</p>

<p><strong>For further information, please don&#39;t hesitate to contact me by e-mail: juha.nurmi@ahmia.fi</strong></p>

  </article>

  <div class="post-footer">
      <a class="post-blog" href="">juha's Blog</a>
  </div>
  <br />

<!-- COMMENTS -->
<div id="comments" class="comments clearfix">
  <div class="comments-loading">
  <p><em>Enable Javascript to view comments</em></p>
  </div>
</div>

<script type="text/javascript" class="juvia">
(function() {
    var loadingSection = document.body.querySelector('.comments-loading');
    var icon = '<p>Comments Loading...</p><img alt="loading comments" src="/assets/images/comments-loading.gif">';

    loadingSection.innerHTML = loadingSection.innerHTML + icon;

    var options = {
        container    : '.comments',
        site_key     : 'im3x57usjcg72fkm6lyqzwzt7vaoi4g',
        topic_key    : '/ahmia-search-after-gsoc-development',
        topic_url    : location.href,
        topic_title  : document.title || location.href,
        include_base : !window.Juvia,
        include_css  : !window.Juvia,
        comment_order: 'latest-first'
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://torblog-juvia-4525.herokuapp.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);

    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0] && commentsLoaded).appendChild(s);

})();
</script>
</div>

<!-- Include the side column -->
<div class="sidecol">

<!-- RSS FEED / SEARCH -->
    <div class="sidefirst">
	<a href="/feed.xml"><img src="/assets/images/rss.png" alt="RSS logo">RSS</a>
	<!-- <a href="#"><img src="/img/rss.png">Atom</a> -->
	<form>
        <input class="searchtext" type="text" size="10" maxlength="10"><input class="searchbutton" type="submit" value="Search">
        </form>
    </div>

<!-- EVENTS -->
    <div class ="sidebox orangebox">
	<h2>Upcoming Events</h2>
	<ul>
	    
		    <li><span><a href="/events/andrew-keynotes-broadband-world-forum">Andrew Keynotes Broadband World Forum</a></span></li>
	    
		    <li><span><a href="/events/roger-usenix-security-symposium-san-diego-ca">Roger @ Usenix Security Symposium, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/roger-foci-%E2%80%9914-san-diego-ca">Roger @ FOCI ’14, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/tor-pets-2014-amsterdam">Tor @ PETS 2014, Amsterdam</a></span></li>
	    
	</ul>
	<span><a href="/events">full calendar &raquo;</a></span>
    </div>
    
<!-- RECENT BLOG POSTS -->
    <div class ="sidebox greenbox">
	<h2>Recent Blog Posts</h2>
	<ul>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-8th-2014">Tor Weekly News — October 8th, 2014</a></span></li>
	  
		    <li><span><a href="/closer-look-great-firewall-china">A closer look at the Great Firewall of China</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-1st-2014">Tor Weekly News — October 1st, 2014</a></span></li>
	  
		    <li><span><a href="/tor-browser-40-alpha-3-released">Tor Browser 4.0-alpha-3 is released</a></span></li>
	  
		    <li><span><a href="/tor-browser-366-released">Tor Browser 3.6.6 is released</a></span></li>
	  
		    <li><span><a href="/tails-112-out">Tails 1.1.2 is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-24th-2014">Tor Weekly News — September 24th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-17th-2014">Tor Weekly News — September 17th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-0257-rc-out">Tor 0.2.5.7-rc is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-10th-2014">Tor Weekly News — September 10th, 2014</a></span></li>
	  
	</ul>
	<span><a href="/archive">more &raquo;</a></span>
    </div>
    
<!-- TAG CLOUD -->
    <div class ="tagbox orangebox">
	<h2>Blog Tag Cloud</h2>
	<ul>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 57%">
        <span><a href="/tag/blog/">
            blog
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/first post/">
            first post
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 171%">
        <span><a href="/tag/tor/">
            tor
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/24c3/">
            24c3
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 57%">
        <span><a href="/tag/ccc/">
            ccc
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 61%">
        <span><a href="/tag/talks/">
            talks
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 59%">
        <span><a href="/tag/bugs/">
            bugs
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 57%">
        <span><a href="/tag/crashes/">
            crashes
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 64%">
        <span><a href="/tag/osx/">
            osx
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/qt/">
            qt
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 86%">
        <span><a href="/tag/vidalia/">
            vidalia
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 68%">
        <span><a href="/tag/vidalia bundle/">
            vidalia bundle
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/meetup/">
            meetup
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 59%">
        <span><a href="/tag/attacks/">
            attacks
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/covert channels/">
            covert channels
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 57%">
        <span><a href="/tag/media coverage/">
            media coverage
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 88%">
        <span><a href="/tag/bridges/">
            bridges
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 59%">
        <span><a href="/tag/incognito/">
            incognito
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 116%">
        <span><a href="/tag/progress report/">
            progress report
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 83%">
        <span><a href="/tag/torbrowser/">
            torbrowser
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 85%">
        <span><a href="/tag/torbutton/">
            torbutton
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 65%">
        <span><a href="/tag/china/">
            china
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 56%">
        <span><a href="/tag/directors/">
            directors
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 76%">
        <span><a href="/tag/release candidate/">
            release candidate
        </a></span>
    </li>

    <!-- this is wack - be careful adjusting these values -->
    <li style="font-size: 74%">
        <span><a href="/tag/gsoc/">
            gsoc
        </a></span>
    </li>

	</ul>
	<span><a href="/tag-cloud">more tags &raquo;</a></span>
    </div>

</div>

<div style="clear: both;"></div>  

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">The Tor Project Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>The Tor Project Blog</li>
          <li><a href="mailto:contact@torproject.org">contact@torproject.org</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jekyll</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
