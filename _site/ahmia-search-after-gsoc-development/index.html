<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Ahmia search after GSoC development</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">
    <meta name="robots" content="noindex" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="css/blog-old-ie.css">
    <![endif]-->
    <!--[if lt IE 9]>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
    <![endif]-->
</head>
<body>

<body>
<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <a href="/"><img class="tor-logo" src="/assets/images/tor_logo.png" alt="Tor logo" /></a>
            <h1 class="brand-title">The Tor Project Blog</h1>
            <h2 class="brand-tagline">News and events from Tor</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/events/">Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="https://www.torproject.org/overview">About Tor</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="https://www.torproject.org/donate/donate">Donate</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>

            <!-- A wrapper for all the blog posts -->
<div class="posts">

  <div id="home">
      <section class="post">
        <header class="post-header">
          <h2 class="post-title"> <a href="">Ahmia search after GSoC development</a></h2>
          <p class="post-meta">
              By <a class="post-author" href="#">juha</a> under
              
                <a class="post-category post-category-js" href="#">ahmia</a>
              
                <a class="post-category post-category-js" href="#">ahmia.fi</a>
              
                <a class="post-category post-category-js" href="#">crawling</a>
              
                <a class="post-category post-category-js" href="#">GSoC 2014</a>
              
                <a class="post-category post-category-js" href="#">hidden services</a>
              
                <a class="post-category post-category-js" href="#">onion</a>
              
                <a class="post-category post-category-js" href="#">search engine</a>
               |
              07 Sep 2014
          </p>
        </header>
        <div class="post-description">
          <p>The Google Summer of Code (GSoC) was an excellent opportunity to improve on the Ahmia search engine. With Google&#39;s stipend and friendly mentoring from The Tor Project, I was able to concentrate on development of my search engine project. Thank you all!</p>

<p><a href="https://trac.torproject.org/projects/tor/wiki/doc/gsoc">GSoC 2014</a> is over, but I am sticking around to continue developing and maintaining Ahmia.</p>

<p>Here is the current status of ahmia after GSoC development:</p>

<h2>Introduction</h2>

<p>Ahmia is <a href="https://github.com/juhanurmi/ahmia/">open-source search engine software</a> for Tor hidden service websites. You can test the running search engine at <a href="https://ahmia.fi/search/">ahmia.fi</a>.</p>

<p>Building a search engine for anonymous web sites running inside the Tor network is an interesting problem. Tor enables web servers to <a href="https://www.torproject.org/docs/hidden-services">hide their location</a> and Tor users can connect to these authenticated hidden services while the server and the user both stay anonymous. However, finding web content is hard without a good search engine and therefore a search engine is needed for the Tor network.</p>

<p>Web search engines are needed to navigate and search the web. There were no search engines for searching hidden service web content, so I decided to build a search engine specially for Tor. I registered ahmia.fi and started development on it as a side project in 2010.</p>

<p>This development involved programming and testing web crawlers, thinking of ways to find hidden service addresses (since the protocol does not allow enumeration), learning about the Tor community, and implementing a filtering policy. Moreover, I implemented <a href="https://ahmia.fi/documentation/">an API</a> that empowers other Tor services that publish content to integrate with Ahmia.</p>

<p>As a result, Ahmia is a working search engine that indexes, searches and catalogs content published on Tor Hidden Services. Furthermore, it is an environment to share meaningful statistics, insights and news about the Tor network itself.</p>

<h2>Interesting Summer of Code</h2>

<p>One of my best memories from the summer is the Tor Project&#39;s Summer 2014 Developers meeting that was hosted by Mozilla in Paris, France. I have always admired the people who are working on the Tor Project.</p>

<p>I also loved the coding itself. Finally I had time to improve the Ahmia search engine and its many features. <a href="https://github.com/juhanurmi/ahmia/commits/master">I did a lot of work</a> and liked it.</p>

<p>Some journalist were very interested in my work: Carola Frediani asked if I could analyze the content of hidden services. I coded a script that fetches every front page&#39;s HTML, I gathered all the keywords, headers and description texts and made a simple word cloud visualization.</p>

<p><img src="https://ahmia.fi/static/visuals/content.png" alt="Hidden website content visualization."></p>

<p>It is a simple way to glance what is published on the hidden websites.</p>

<p>Carola found this data useful and used it in her presentation at <a href="http://www.sotn.it" title="www.sotn.it">www.sotn.it</a> on June 11th.</p>

<h2>Technical design of ahmia</h2>

<p>The Ahmia web service is written using the Django web framework. As a result, the server-side language is Python. On the client-side, most of the pages are plain HTML. There are some pages that require JavaScript, but the search itself works without client-side JavaScript.</p>

<p>The components of Ahmia are:</p>

<ul>
<li>Django front-end site</li>
<li>PostgreSQL database for the site</li>
<li>Custom scripts to download data about hidden services</li>
<li>Django-Haystack connection to Solr database</li>
<li>Apache Solr for the crawled data</li>
<li>OnionBot crawler that gathers data to Solr database</li>
</ul>

<p><img src="https://raw.githubusercontent.com/juhanurmi/ahmia/master/technical_architecture.png" alt="Technical architecture."></p>

<p><a href="https://github.com/juhanurmi/ahmia/blob/master/README.md">See installation and developing tutorial</a></p>

<h2>Search</h2>

<p>The full-text search is implemented using Django-Haystack. The search is using crawled website data that is saved to Apache Solr.</p>

<h2>OnionDir</h2>

<p><a href="https://ahmia.fi/address/">OnionDir</a> is a list of known online hidden service addresses. A separate script gathers this list and fetches information fields from the HTML (title, keywords, description etc.). Furthermore, users can freely edit these fields.</p>

<p>We&#39;ve also started a convention where hidden service admins can add a file to their website, called <a href="https://ahmia.fi/documentation/descriptionProposal/">description.json</a>, to offer an official description of their site in Ahmia.</p>

<p>As a result, this information is shown in <a href="https://ahmia.fi/address/#/search=Description%20downloaded%20directly%20from%20the%20hidden%20service.">the OnionDir page</a> and over 80 domains are already using this method.</p>

<h2>Statistics</h2>

<p>We are gathering statistics from hidden services. As a result, we can represent and share <a href="https://ahmia.fi/documentation/">meaningful data about hidden services</a> and <a href="https://ahmia.fi/stats/viewer">visualize it</a>.</p>

<p>We are gathering three types of popularity data:</p>

<ol>
<li>Tor2web nodes share their visiting statistics to Ahmia</li>
<li>Number of public WWW backlinks to hidden services</li>
<li>Number of clicks in the search results</li>
</ol>

<p>The click counter tells the total number of clicks on a search result in ahmia.fi</p>

<h2>Filtering</h2>

<p>We have decided to filter any sites related to child porn from our search results. Ahmia is removing everything related to these websites. These websites may not be actual child porn sites. They are rather sites where users can post content (forums, file and image uploads etc.) and as the result there have been, momentarily at least, some suspicious content that has not been moderated in a reasonable period of time. Ahmia.fi does not have the time to monitor these sites carefully and we are banning sites from our public index if we see any evidence of child abuse. Of course, the ban is removed if the site itself contacts us and we review the website to be OK.</p>

<p>In practice, Ahmia calculates the MD5 sums of the banned domains for use as a filtering policy. Moreover, we are sharing this list and Tor2web nodes can use the list to filter out pages.</p>

<p>At the moment, there seems to be 1228 hidden website domains online and 7 of them has been filtered because they are possibly sharing child porn content.</p>

<h2>OnionBot</h2>

<p><a href="https://github.com/juhanurmi/ahmia/tree/master/onionbot">OnionBot</a> is a crawler for hidden service websites based on the Scrapy framework. It crawls the Tor network and passes data to the search database. OnionBot requires the Tor software (using Tor2web mode) and Polipo. The results are saved to Apache Solr.</p>

<h2>Apache Solr</h2>

<p>Apache Solr is a popular, open source enterprise search platform. Its major features include powerful full-text search, hit highlighting, faceted search, and near real-time indexing.</p>

<p>The <a href="https://github.com/juhanurmi/ahmia/blob/master/solr/schema.xml">schema.xml</a> file contains all of the details about which fields your documents can contain, and how those fields should be dealt with when adding documents to the index, or when querying those fields.</p>

<h2>Security measures for privacy</h2>

<p>In the software</p>

<ul>
<li>We do not log any IP addresses, see <a href="https://github.com/juhanurmi/ahmia/tree/master/apache2">Apache configuration</a></li>
<li>We are gathering real-time clicks, however, this data is not shown accurately</li>
</ul>

<p>In the host ahmia.fi</p>

<ul>
<li>Backend servers are run separately and they do not have any knowledge about the end-users</li>
<li>All servers are hosted in countries with strong privacy laws. For example, Finland and the Netherlands</li>
<li>Communication between servers is encrypted</li>
<li>Only a few trustworthy people know the locations of the back-end servers and are able to access them</li>
</ul>

<h2>Future work</h2>

<p>GSoC 2014 was fun and productive!</p>

<p>There is a lot more to do. However, I do not have time to do everything myself. Of course, I am coding when I have time and maintaining the search engine.</p>

<p>In addition, I am going to write a scientific article about the implementation.</p>

<p>Is there anyone who would be interested in developing Ahmia.fi?</p>

<p>Is anyone familiar with Solr and would know how to tweak it for full text search?</p>

<p>Furthermore, any kind of help would be most welcome. There are always Linux admin duties, HTML/CSS design, bug fixing, Django development, etc...</p>

<p><strong>For further information, please don&#39;t hesitate to contact me by e-mail: juha.nurmi@ahmia.fi</strong></p>

        </div>
      </section>
  </div>

</div>



<div class="comments clearfix">
  <div class="comments-loading">
  <p><em>Comments will not load without Javascript enabled</em></p>
  </div>
</div>

<script type="text/javascript" class="juvia">
(function() {
    var loadingSection = document.body.querySelector('.comments-loading');
    var icon = '<p>Comments Loading...</p><img alt="loading comments" src="/assets/images/comments-loading.gif">';

    loadingSection.innerHTML = loadingSection.innerHTML + icon;

    var options = {
        container    : '.comments',
        site_key     : 'im3x57usjcg72fkm6lyqzwzt7vaoi4g',
        topic_key    : '/ahmia-search-after-gsoc-development',
        topic_url    : location.href,
        topic_title  : document.title || location.href,
        include_base : !window.Juvia,
        include_css  : !window.Juvia,
        comment_order: 'latest-first'
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://torblog-juvia-4525.herokuapp.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);

    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0] && commentsLoaded).appendChild(s);

})();
</script>


            <div class="footer">
                <div class="pure-menu pure-menu-horizontal pure-menu-open">
                    <ul>
                        <li><a href="http://purecss.io/">About</a></li>
                        <li><a href="http://twitter.com/yuilibrary/">Twitter</a></li>
                        <li><a href="http://github.com/yahoo/pure/">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
