<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>The MD5 certificate collision attack, and what it means for Tor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">
    <meta name="robots" content="noindex" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="css/blog-old-ie.css">
    <![endif]-->
    <!--[if lt IE 9]>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
    <![endif]-->
</head>
<body>

<body>
<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <a href="/"><img class="tor-logo" src="/assets/images/tor_logo.png" alt="Tor logo" /></a>
            <h1 class="brand-title">The Tor Project Blog</h1>
            <h2 class="brand-tagline">News and events from Tor</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/events/">Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="https://www.torproject.org/overview">About Tor</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="https://www.torproject.org/donate/donate">Donate</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>

            <!-- A wrapper for all the blog posts -->
<div class="posts">

  <div id="home">
      <section class="post">
        <header class="post-header">
          <h2 class="post-title"> <a href="">The MD5 certificate collision attack, and what it means for Tor</a></h2>
          <p class="post-meta">
              By <a class="post-author" href="#">nickm</a> under
              
                <a class="post-category post-category-js" href="#">attack</a>
              
                <a class="post-category post-category-js" href="#">md5</a>
              
                <a class="post-category post-category-js" href="#">security</a>
              
                <a class="post-category post-category-js" href="#">ssl</a>
              
                <a class="post-category post-category-js" href="#">tls</a>
              
                <a class="post-category post-category-js" href="#">x509</a>
               |
              30 Dec 2008
          </p>
        </header>
        <div class="post-description">
          <p>Today, a team of security researchers and cryptographers gave a talk at the <a href="http://events.ccc.de/congress/2008/">25th Chaos Communication Congress (25C3)</a>, about a <a href="http://www.win.tue.nl/hashclash/rogue-ca/">nifty attack against X.509 certificates generated using the MD5 digest algorithm</a>. We figured that people will ask us about how this attack affects Tor, so I&#39;m writing an answer in advance.</p>

<p><strong>The short version:</strong> This attack doesn&#39;t affect Tor.</p>

<p><strong>The medium version:</strong> This attack doesn&#39;t affect Tor, since Tor doesn&#39;t ever use MD5 certificates, and since Tor doesn&#39;t care what certificate authorities say. On the other hand, this attack probably <em>does</em> affect your browser. Check your browser vendor for updates over the next few days and weeks, and make sure you install them.</p>

<p><strong>The long version:</strong> To understand the attack, first you&#39;ve got to understand certificates. When your browser makes a connection to a &quot;secure&quot; website, it uses a protocol called <a href="http://en.wikipedia.org/wiki/Transport_layer_security">SSL (or sometimes TLS)</a> to see who it&#39;s talking to and encrypt the connection with them. In SSL, parties are identified using <a href="http://en.wikipedia.org/wiki/X.509">X.509 certificates</a>, which are issued to them by certificate authorities, or &quot;CA&quot;s. Your browser comes with <a href="http://www.mozilla.org/projects/security/certs/included/">a big list of certificate authorities</a>. When your browser sees a certificate that was signed by a certificate authority it recognizes, it knows it&#39;s talking to the right website.</p>

<p>Certificates, like nearly anything of interest, are too big to sign as-is, so the CA uses a <a href="http://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic &quot;digest&quot; algorithm</a> to derive a short &quot;hash&quot; of the certificate that it can sign. The digest algorithm is supposed to be &quot;collision resistant&quot;, so that nobody can find two different certificates that produce the same hash. Such a collision would be bad, since somebody who could produce two such certificates could get a CA to sign one of them, and then use that signature on the other one. Since the hash values would be the same, nobody would be able to tell that the CA had not really signed the second certificate.</p>

<p>With me so far? Good. Let&#39;s talk about MD5. There is an old broken hash algorithm called <a href="http://en.wikipedia.org/wiki/MD5">MD5</a>. How old and broken? Cryptographers have considered it weak since 1996 or so, and there have been known real collisions in it since 2004. In 2007, researchers published a method for generating MD5 collisions that could be used against X.509 certificates. In other words, the writing has been on the wall since at least 1996 (arguably 1993), and the writing has been getting bigger year after year. You&#39;d have to be pretty oblivious to still use MD5 for signing certificates in 2008!</p>

<p>Unfortunately, some brave CAs still use MD5 for signing certificates in 2008. And so we come to the attack.</p>

<p>Using a method derived from the 2007 paper, and a cluster of 200 Playstation 3s, the researchers generated two certificates that would produce an MD5 collision: one innocuous one, and one CA certificate. They got a CA to sign the first one, and then transferred this signature to the second. Since the second certificate was for a CA, they now had a certificate that let them generate their <em>own</em> certificates, and make any phony claims they wanted about the identity of any website. If your browser saw one of these phony certificates, it would believe it, since it was ultimately signed by a CA it recognized.</p>

<p>For more information on the attack, with a lot of complicated tricky bits I didn&#39;t mention, see <a href="http://www.win.tue.nl/hashclash/rogue-ca/">the authors&#39; writeup</a>.</p>

<p>The good news is that <strong>Tor itself is not affected</strong> . Tor doesn&#39;t use MD5 for anything[*]. Tor doesn&#39;t use commercial CAs. Tor doesn&#39;t sign certificates for others, and everything in Tor that is signed is signed using SHA-1, not MD5.[**]</p>

<p>The bad news is that your browser probably does have some of the affected CAs listed. As how-to guides for securing your browser become available, we&#39;ll post links to them here.</p>

<p>Finally: Happy new year! And best wishes to any programmers who get stuck working all night on New Year&#39;s Eve to remove MD5 from their system.</p>

<p>Footnotes:</p>

<p>[*] The fine print: Tor uses the TLS protocol, which uses MD5 in a couple of places. But TLS uses in tandem with SHA-1, so an attacker will need to break SHA-1 and MD5 at the same time to harm TLS&#39;s security. Read RFC2246 for the ugly ugly details.</p>

<p>[**] Yes, I know that SHA-1 is showing its age too. Unfortunately, the SHA-2 algorithms aren&#39;t <em>that</em> much better, and nothing else has seen the same amount of analysis. Once the <a href="http://en.wikipedia.org/wiki/NIST_hash_function_competition">NIST hash function competition</a> has picked a SHA-3 candidate, we&#39;ll switch to that. In the mean time, I&#39;ll be launching some design work on or-dev to make it easier for Tor to switch to a better hash algorithm, once we&#39;ve got one, or in case we need to jump off SHA-1 in a hurry.</p>

        </div>
      </section>
  </div>

</div>

<div class="comments"></div>

<script type="text/javascript" class="juvia">
(function() {
    var options = {
        container    : '.comments',
        site_key     : 'im3x57usjcg72fkm6lyqzwzt7vaoi4g',
        topic_key    : '/blog/md5-certificate-collision-attack%2C-and-what-it-means-tor',
        topic_url    : location.href,
        topic_title  : document.title || location.href,
        include_base : !window.Juvia,
        include_css  : !window.Juvia,
        comment_order: 'latest-first'
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://torblog-juvia-4525.herokuapp.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);
    (document.getElementsByTagName('head')[0] ||
     document.getElementsByTagName('body')[0]).appendChild(s);
})();
</script>


            <div class="footer">
                <div class="pure-menu pure-menu-horizontal pure-menu-open">
                    <ul>
                        <li><a href="http://purecss.io/">About</a></li>
                        <li><a href="http://twitter.com/yuilibrary/">Twitter</a></li>
                        <li><a href="http://github.com/yahoo/pure/">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
