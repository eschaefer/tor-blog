<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Deterministic Builds Part One: Cyberwar and Global Compromise</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/blog/deterministic-builds-part-one-cyberwar-and-global-compromise">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">The Tor Project Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
	<a class="page-link" href="/">Blog Home</a>
        <a class="page-link" href="/archives">Archives</a>
	<a class="page-link" href="https://www.torproject.org/about/overview">About Tor</a>
        <a class="page-link donate" href="https://www.torproject.org/donate/donate">Donate</a>

      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <!-- Pages with side column need a 'maincol' class -->
<div class="post maincol">

  <header class="post-header">
    <h1 class="post-title">Deterministic Builds Part One: Cyberwar and Global Compromise</h1>
    <p class="post-meta">Aug 20, 2013 • mikeperry</p>
  </header>

  <article class="post-content">
    <p>I&#39;ve spent the past few months developing a new build system for the <a href="https://blog.torproject.org/category/tags/tbb-30">3.0 series</a> of the Tor Browser Bundle that produces what are called &quot;deterministic builds&quot; -- packages which are byte-for-byte identical no matter who actually builds them, or what hardware they use. This effort was extraordinarily involved, consuming all of my development time for over two months (including several nights and weekends), babysitting builds and fixing differences and issues that arose.</p>

<p>When describing my recent efforts to others, by far the two most common questions I&#39;ve heard are &quot;Why did you do that?&quot; and &quot;How did you do that?&quot;. I&#39;ve decided to answer each question at length in a separate blog post. This blog post attempts to answer the first question: &quot;Why would anyone want a deterministic build process?&quot;</p>

<p>The short answer is: to protect against targeted attacks. Current popular software development practices simply cannot survive targeted attacks of the scale and scope that we are seeing today. In fact, I believe we&#39;re just about to witness the first examples of large scale &quot;watering hole&quot; attacks. This would be malware that attacks the software development and build processes themselves to distribute copies of itself to tens or even hundreds of millions of machines in a single, officially signed, instantaneous update. Deterministic, distributed builds are perhaps the only way we can reliably prevent these types of targeted attacks in the face of the endless stockpiling of weaponized exploits and other &quot;cyberweapons&quot;.</p>

<h1>The Dangerous Pursuit of &quot;Cyberweapons&quot; and &quot;Cyberwar&quot;</h1>

<p>For the past several years, we&#39;ve been seeing a <a href="http://www.reuters.com/article/2013/05/10/us-usa-cyberweapons-specialreport-idUSBRE9490EL20130510">steady increase</a> in the weaponization, stockpiling, and the use of software exploits by multiple governments, and by multiple agencies of multiple governments. It would seem that no networked computer is safe from a discovered but undisclosed and already weaponized vulnerability against one or more of its software components -- with each vulnerability being resold an unknown number of times.</p>

<p>Worse still, with <a href="http://spectrum.ieee.org/telecom/security/the-real-story-of-stuxnet">Stuxnet and Flame</a>, this stockpile has grown to include weaponized exploits specifically designed to &quot;bridge the air gap&quot; against even non-networked computers. Examples include exploits against software/hardware USB stacks, filesystem drivers, hard drive firmware, and even disconnected Bluetooth and Wifi interfaces. Even if these exploits themselves don&#39;t leak, the fact that they are known to exist (and are known to be deliberately kept secret from manufacturers and developers) means that other parties can begin looking for (or simply re-purchasing) the underlying vulnerabilities themselves, without fear of their disclosure or mitigation.</p>

<p>Unfortunately, the use of such exploits isn&#39;t limited to attacks against questionable nuclear energy programs by hostile states. The clock is certainly ticking on how long it will be before multiple other intelligence agencies, along with elements of organized crime and &quot;terrorist&quot; groups, have replicated these weapons.</p>

<p>We are essentially risking all of computing (or at least major sectors of the world economy that are dependent on specific software systems) by stockpiling these weapons, as if there would be any possibility of retaliation after a serious cyberattack. Wakeup call: There is not. In fact, the more exploits exist, the higher the risk of the wrong one leaking -- and it really only takes a chain of just a few of the right exploits for this to happen.</p>

<h1>Software Engineering Complexity: The Doomsday Scenario</h1>

<p>The core problem is this: With the number of dependencies present in large software projects, there is no way any amount of global surveillance, network censorship, machine isolation, or firewalling can sufficiently protect the software development process of widely deployed software projects in order to prevent scenarios where malware sneaks into a development dependency through an exploit in combination with code injection, and makes its way into the build process of software that is critical to the function of the world economy.</p>

<p>Such malware could be quite simple: One day, a timer goes off, and any computer running the infected software turns into a brick. In fact, it&#39;s not that hard to destroy a computer via software. Linux distributions have been accidentally tripping on bugs that do it for two decades now. If the right software vector is chosen (for example, a popular piece of software with a rapid release cycle and an auto-updater), a logic bomb that infects the build systems could continuously update the timestamps in the distributed versions of itself to ensure that the infected computers are only destroyed in the event that the attacker actually loses control of the software build infrastructure. If the right systems are chosen, this destruction could mean the disruption of all industrial control or supply chain systems simultaneously, disabling the ability to provide food, water, power, and aid to hundreds of millions of people in a very short amount of time.</p>

<p>The malware could also be more elaborate, especially if the motives are financial as opposed to purely destructive. The ability to universally deploy a backdoor that would allow modification of various aspects of financial transaction processing, stock markets, insurance records, and the supply chain records of various industries would prove tremendously profitable in the right circumstances. Just about all aspects of business are computerized now, and if the computer systems say an event did or didn&#39;t happen, that is the reality. Even short of modification, early access to information about certain events is also valuable -- unreleased earnings data from publicly traded companies being the immediate example.</p>

<p>In this brave new world, without the benefit of anonymity and decentralization to protect single points of failure in the software engineering process from such targeted attacks, I don&#39;t believe it is possible to keep software signing keys secure any more, nor do I believe it is possible to keep even an offline build machine secure from malware injection any more, especially against the types of adversaries that Tor has to contend with.</p>

<p>As someone who regularly discusses software engineering practices with the best and the brightest minds in the computer industry, I can tell you with certainty that even companies that exercise current best practices -- such as keeping their software build machines offline (and even these companies are few and far between) can still end up being infected, due to the existence and proliferation of the air gap bridging exploits mentioned above.</p>

<p>A true air gap is also difficult to achieve even if it could be used to ensure build machine integrity. For example, all of the major Windows web browser vendors employ a Microsoft run-time optimization technique called &quot;Profile Guided Optimization&quot;. This technique requires running an initial compiled binary on a machine to produce a profile output that represents which code paths were executed and which were most expensive. This output is used to transform its code and optimize it further. In the case of browsers, this means that an untrusted, proprietary, and opaque input is derived from non-deterministic network sources (such as the Alexa Top 1000) and transferred to the build machines, to produce executable code that is manipulated and rewritten based on this network-derived, untrusted input, and upon the performance and other characteristics of the specific machine that was used to generate this profile output.</p>

<p>This means that software development has no choice but to evolve beyond the simple models of &quot;Trust our RSA-signed update feed produced from our trusted build machines&quot;, or even companies like Google, Mozilla, Apple, and Microsoft are going to end up distributing state-sponsored malware in short order.</p>

<h1>Deterministic Builds: Integrity through Decentralization</h1>

<p>This is where the &quot;why&quot; of deterministic builds finally comes in: in our case, any individual can use our anonymity network to privately download our source code, verify it against public signed, audited, and mirrored git repositories, and reproduce our builds exactly, without being subject to such targeted attacks. If they notice any differences, they can alert the public builders/signers, hopefully using a pseudonym or our anonymous trac account.</p>

<p>This also will eventually allow us to create a number of auxiliary authentication mechanisms for our packages, beyond just trusting a single offline build machine and a single cryptographic key&#39;s integrity. Interesting examples include providing multiple independent cryptographic signatures for packages, listing the package hashes in the Tor consensus, and encoding the package hashes in the Bitcoin blockchain.</p>

<p>I believe it is important for Tor to set an example on this point, and I hope that the Linux distributions will follow in making deterministic packaging the norm. Thankfully, due to our close relationship with Debian, after we whispered in a few of the right ears <a href="https://wiki.debian.org/ReproducibleBuilds">they have started work</a> on this effort. Don&#39;t despair guys: it won&#39;t take two months for each Linux package. In our case, we had to cross-compile Firefox deterministically for four different target operating system and architecture combinations and fix a number of Firefox-specific build issues, all of which I will describe in the <a href="https://blog.torproject.org/blog/deterministic-builds-part-two-technical-details">second post on the technical details</a>.</p>

  </article>

  <div class="post-footer">
      <a class="post-blog" href="">mikeperry's Blog</a>
  </div>
  <br />

</div>

<!-- Include the side column --->
<div class="sidecol">

<!-- RSS FEED / SEARCH -->
    <div class="sidefirst">
	<a href="/feed.xml"><img src="/assets/images/rss.png">RSS</a>
	<!-- <a href="#"><img src="/img/rss.png">Atom</a> -->
	<form>
        <input class="searchtext" type="text" size="10" maxlength="10"><input class="searchbutton" type="submit" value="Search">
        </form>
    </div>

<!-- EVENTS -->
    <div class ="sidebox orangebox">
	<h2>Upcoming Events</h2>
	<ul>
	    
		    <li><span><a href="/events/andrew-keynotes-broadband-world-forum">Andrew Keynotes Broadband World Forum</a></span></li>
	    
		    <li><span><a href="/events/roger-usenix-security-symposium-san-diego-ca">Roger @ Usenix Security Symposium, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/roger-foci-%E2%80%9914-san-diego-ca">Roger @ FOCI ’14, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/tor-pets-2014-amsterdam">Tor @ PETS 2014, Amsterdam</a></span></li>
	    
	</ul>
	<span><a href="/events">full calendar &raquo;</a></span>
    </div>
    
<!-- RECENT BLOG POSTS -->
    <div class ="sidebox greenbox">
	<h2>Recent Blog Posts</h2>
	<ul>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-8th-2014">Tor Weekly News — October 8th, 2014</a></span></li>
	  
		    <li><span><a href="/closer-look-great-firewall-china">A closer look at the Great Firewall of China</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-1st-2014">Tor Weekly News — October 1st, 2014</a></span></li>
	  
		    <li><span><a href="/tor-browser-40-alpha-3-released">Tor Browser 4.0-alpha-3 is released</a></span></li>
	  
		    <li><span><a href="/tor-browser-366-released">Tor Browser 3.6.6 is released</a></span></li>
	  
		    <li><span><a href="/tails-112-out">Tails 1.1.2 is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-24th-2014">Tor Weekly News — September 24th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-17th-2014">Tor Weekly News — September 17th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-0257-rc-out">Tor 0.2.5.7-rc is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-10th-2014">Tor Weekly News — September 10th, 2014</a></span></li>
	  
	</ul>
	<span><a href="/">more &raquo;</a></span>
    </div>
    
<!-- TAG CLOUD -->
    <div class ="tagbox orangebox">
	<h2>Blog Tag Cloud</h2>
	<ul>

    <li style="font-size: 57%">
        <span><a href="/tag/blog/">
            blog
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/first post/">
            first post
        </a></span>
    </li>

    <li style="font-size: 171%">
        <span><a href="/tag/tor/">
            tor
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/24c3/">
            24c3
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/ccc/">
            ccc
        </a></span>
    </li>

    <li style="font-size: 61%">
        <span><a href="/tag/talks/">
            talks
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/bugs/">
            bugs
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/crashes/">
            crashes
        </a></span>
    </li>

    <li style="font-size: 64%">
        <span><a href="/tag/osx/">
            osx
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/qt/">
            qt
        </a></span>
    </li>

    <li style="font-size: 86%">
        <span><a href="/tag/vidalia/">
            vidalia
        </a></span>
    </li>

    <li style="font-size: 68%">
        <span><a href="/tag/vidalia bundle/">
            vidalia bundle
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/meetup/">
            meetup
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/attacks/">
            attacks
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/covert channels/">
            covert channels
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/media coverage/">
            media coverage
        </a></span>
    </li>

    <li style="font-size: 88%">
        <span><a href="/tag/bridges/">
            bridges
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/incognito/">
            incognito
        </a></span>
    </li>

    <li style="font-size: 116%">
        <span><a href="/tag/progress report/">
            progress report
        </a></span>
    </li>

    <li style="font-size: 83%">
        <span><a href="/tag/torbrowser/">
            torbrowser
        </a></span>
    </li>

    <li style="font-size: 85%">
        <span><a href="/tag/torbutton/">
            torbutton
        </a></span>
    </li>

    <li style="font-size: 65%">
        <span><a href="/tag/china/">
            china
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/directors/">
            directors
        </a></span>
    </li>

    <li style="font-size: 76%">
        <span><a href="/tag/release candidate/">
            release candidate
        </a></span>
    </li>

    <li style="font-size: 74%">
        <span><a href="/tag/gsoc/">
            gsoc
        </a></span>
    </li>

	</ul>
	<span><a href="/tag-cloud">more tags &raquo;</a></span>
    </div>

</div>

<div style="clear: both;"></div>  


<!-- COMMENTS -->
<div id="comments" class="comments clearfix">
  <div class="comments-loading">
  <p><em>Enable Javascript to view comments</em></p>
  </div>
</div>

<script type="text/javascript" class="juvia">
(function() {
    var loadingSection = document.body.querySelector('.comments-loading');
    var icon = '<p>Comments Loading...</p><img alt="loading comments" src="/assets/images/comments-loading.gif">';

    loadingSection.innerHTML = loadingSection.innerHTML + icon;

    var options = {
        container    : '.comments',
        site_key     : 'im3x57usjcg72fkm6lyqzwzt7vaoi4g',
        topic_key    : '/blog/deterministic-builds-part-one-cyberwar-and-global-compromise',
        topic_url    : location.href,
        topic_title  : document.title || location.href,
        include_base : !window.Juvia,
        include_css  : !window.Juvia,
        comment_order: 'latest-first'
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://torblog-juvia-4525.herokuapp.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);

    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0] && commentsLoaded).appendChild(s);

})();
</script>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">The Tor Project Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>The Tor Project Blog</li>
          <li><a href="mailto:contact@torproject.org">contact@torproject.org</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jekyll</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
