<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Tor 0.2.1.18 and 0.2.1.19 released as stable</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/blog/tor-02118-and-02119-released-stable">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">The Tor Project Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
	<a class="page-link" href="/">Blog Home</a>
        <a class="page-link" href="/archives">Archives</a>
	<a class="page-link" href="https://www.torproject.org/about/overview">About Tor</a>
        <a class="page-link donate" href="https://www.torproject.org/donate/donate">Donate</a>

      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <!-- Pages with side column need a 'maincol' class -->
<div class="post maincol">

  <header class="post-header">
    <h1 class="post-title">Tor 0.2.1.18 and 0.2.1.19 released as stable</h1>
    <p class="post-meta">Aug 6, 2009 • phobos</p>
  </header>

  <article class="post-content">
    <p>Tor 0.2.1.18 lays the foundations for performance improvements, adds
status events to help users diagnose bootstrap problems, adds optional
authentication/authorization for hidden services, fixes a variety of
potential anonymity problems, and includes a huge pile of other features
and bug fixes.</p>

<p>Tor 0.2.1.19 fixes a major bug with accessing and providing hidden
services.</p>

<p><a href="https://www.torproject.org/easy-download" title="https://www.torproject.org/easy-download">https://www.torproject.org/easy-download</a></p>

<p>Changes in version 0.2.1.19 - 2009-07-28
<strong>Major bugfixes:</strong></p>

<ul>
<li>Make accessing hidden services on 0.2.1.x work right again.
Bugfix on 0.2.1.3-alpha; workaround for bug 1038. Diagnosis and
part of patch provided by &quot;optimist&quot;.</li>
</ul>

<p><strong>Minor features:</strong></p>

<ul>
<li>When a relay/bridge is writing out its identity key fingerprint to
the &quot;fingerprint&quot; file and to its logs, write it without spaces. Now
it will look like the fingerprints in our bridges documentation,
and confuse fewer users.</li>
</ul>

<p><strong>Minor bugfixes:</strong></p>

<ul>
<li>Relays no longer publish a new server descriptor if they change
their MaxAdvertisedBandwidth config option but it doesn&#39;t end up
changing their advertised bandwidth numbers. Bugfix on 0.2.0.28-rc;
fixes bug 1026. Patch from Sebastian.</li>
<li>Avoid leaking memory every time we get a create cell but we have
so many already queued that we refuse it. Bugfix on 0.2.0.19-alpha;
fixes bug 1034. Reported by BarkerJr.</li>
</ul>

<p>Changes in version 0.2.1.18 - 2009-07-24
<strong>Major features (clients):</strong></p>

<ul>
<li>Start sending &quot;bootstrap phase&quot; status events to the controller,
so it can keep the user informed of progress fetching directory
information and establishing circuits. Also inform the controller
if we think we&#39;re stuck at a particular bootstrap phase. Implements
proposal 137.</li>
<li>Clients replace entry guards that were chosen more than a few months
ago. This change should significantly improve client performance,
especially once more people upgrade, since relays that have been
a guard for a long time are currently overloaded.</li>
<li>Network status consensus documents and votes now contain bandwidth
information for each relay. Clients use the bandwidth values
in the consensus, rather than the bandwidth values in each
relay descriptor. This approach opens the door to more accurate
bandwidth estimates once the directory authorities start doing
active measurements. Implements part of proposal 141.</li>
</ul>

<p><strong>Major features (relays):</strong></p>

<ul>
<li>Disable and refactor some debugging checks that forced a linear scan
over the whole server-side DNS cache. These accounted for over 50%
of CPU time on a relatively busy exit node&#39;s gprof profile. Also,
disable some debugging checks that appeared in exit node profile
data. Found by Jacob.</li>
<li>New DirPortFrontPage option that takes an html file and publishes
it as &quot;/&quot; on the DirPort. Now relay operators can provide a
disclaimer without needing to set up a separate webserver. There&#39;s
a sample disclaimer in contrib/tor-exit-notice.html.</li>
</ul>

<p><strong>Major features (hidden services):</strong></p>

<ul>
<li>Make it possible to build hidden services that only certain clients
are allowed to connect to. This is enforced at several points,
so that unauthorized clients are unable to send INTRODUCE cells
to the service, or even (depending on the type of authentication)
to learn introduction points. This feature raises the bar for
certain kinds of active attacks against hidden services. Design
and code by Karsten Loesing. Implements proposal 121.</li>
<li>Relays now store and serve v2 hidden service descriptors by default,
i.e., the new default value for HidServDirectoryV2 is 1. This is
the last step in proposal 114, which aims to make hidden service
lookups more reliable.</li>
</ul>

<p><strong>Major features (path selection):</strong></p>

<ul>
<li>ExitNodes and Exclude*Nodes config options now allow you to restrict
by country code (&quot;{US}&quot;) or IP address or address pattern
(&quot;255.128.0.0/16&quot;). Patch from Robert Hogan. It still needs some
refinement to decide what config options should take priority if
you ask to both use a particular node and exclude it.</li>
</ul>

<p><strong>Major features (misc):</strong></p>

<ul>
<li>When building a consensus, do not include routers that are down.
This cuts down 30% to 40% on consensus size. Implements proposal
138.</li>
<li>New TestingTorNetwork config option to allow adjustment of
previously constant values that could slow bootstrapping. Implements
proposal 135. Patch from Karsten.</li>
<li>Convert many internal address representations to optionally hold
IPv6 addresses. Generate and accept IPv6 addresses in many protocol
elements. Make resolver code handle nameservers located at IPv6
addresses.</li>
<li>More work on making our TLS handshake blend in: modify the list
of ciphers advertised by OpenSSL in client mode to even more
closely resemble a common web browser. We cheat a little so that
we can advertise ciphers that the locally installed OpenSSL doesn&#39;t
know about.</li>
<li>Use the TLS1 hostname extension to more closely resemble browser
behavior.</li>
</ul>

<p><strong>Security fixes (anonymity/entropy):</strong></p>

<ul>
<li>Never use a connection with a mismatched address to extend a
circuit, unless that connection is canonical. A canonical
connection is one whose address is authenticated by the router&#39;s
identity key, either in a NETINFO cell or in a router descriptor.</li>
<li>Implement most of proposal 110: The first K cells to be sent
along a circuit are marked as special &quot;early&quot; cells; only K &quot;early&quot;
cells will be allowed. Once this code is universal, we can block
certain kinds of denial-of-service attack by requiring that EXTEND
commands must be sent using an &quot;early&quot; cell.</li>
<li>Resume using OpenSSL&#39;s RAND_poll() for better (and more portable)
cross-platform entropy collection again. We used to use it, then
stopped using it because of a bug that could crash systems that
called RAND_poll when they had a lot of fds open. It looks like the
bug got fixed in late 2006. Our new behavior is to call RAND_poll()
at startup, and to call RAND_poll() when we reseed later only if
we have a non-buggy OpenSSL version.</li>
<li>When the client is choosing entry guards, now it selects at most
one guard from a given relay family. Otherwise we could end up with
all of our entry points into the network run by the same operator.
Suggested by Camilo Viecco. Fix on 0.1.1.11-alpha.</li>
<li>Do not use or believe expired v3 authority certificates. Patch
from Karsten. Bugfix in 0.2.0.x. Fixes bug 851.</li>
<li>Drop begin cells to a hidden service if they come from the middle
of a circuit. Patch from lark.</li>
<li>When we erroneously receive two EXTEND cells for the same circuit
ID on the same connection, drop the second. Patch from lark.</li>
<li>Authorities now vote for the Stable flag for any router whose
weighted MTBF is at least 5 days, regardless of the mean MTBF.</li>
<li>Clients now never report any stream end reason except &#39;MISC&#39;.
Implements proposal 148.</li>
</ul>

<p><strong>Major bugfixes (crashes):</strong></p>

<ul>
<li>Parse dates and IPv4 addresses in a locale- and libc-independent
manner, to avoid platform-dependent behavior on malformed input.</li>
<li>Fix a crash that occurs on exit nodes when a nameserver request
timed out. Bugfix on 0.1.2.1-alpha; our CLEAR debugging code had
been suppressing the bug since 0.1.2.10-alpha. Partial fix for
bug 929.</li>
<li>Do not assume that a stack-allocated character array will be
64-bit aligned on platforms that demand that uint64_t access is
aligned. Possible fix for bug 604.</li>
<li>Resolve a very rare crash bug that could occur when the user forced
a nameserver reconfiguration during the middle of a nameserver
probe. Fixes bug 526. Bugfix on 0.1.2.1-alpha.</li>
<li>Avoid a &quot;0 divided by 0&quot; calculation when calculating router uptime
at directory authorities. Bugfix on 0.2.0.8-alpha.</li>
<li>Fix an assertion bug in parsing policy-related options; possible fix
for bug 811.</li>
<li>Rate-limit too-many-sockets messages: when they happen, they happen
a lot and end up filling up the disk. Resolves bug 748.</li>
<li>Fix a race condition that could cause crashes or memory corruption
when running as a server with a controller listening for log
messages.</li>
<li>Avoid crashing when we have a policy specified in a DirPolicy or
SocksPolicy or ReachableAddresses option with ports set on it,
and we re-load the policy. May fix bug 996.</li>
<li>Fix an assertion failure on 64-bit platforms when we allocated
memory right up to the end of a memarea, then realigned the memory
one step beyond the end. Fixes a possible cause of bug 930.</li>
<li>Protect the count of open sockets with a mutex, so we can&#39;t
corrupt it when two threads are closing or opening sockets at once.
Fix for bug 939. Bugfix on 0.2.0.1-alpha.</li>
</ul>

<p><strong>Major bugfixes (clients):</strong></p>

<ul>
<li>Discard router descriptors as we load them if they are more than
five days old. Otherwise if Tor is off for a long time and then
starts with cached descriptors, it will try to use the onion keys
in those obsolete descriptors when building circuits. Fixes bug 887.</li>
<li>When we choose to abandon a new entry guard because we think our
older ones might be better, close any circuits pending on that
new entry guard connection. This fix should make us recover much
faster when our network is down and then comes back. Bugfix on
0.1.2.8-beta; found by lodger.</li>
<li>When Tor clients restart after 1-5 days, they discard all their
cached descriptors as too old, but they still use the cached
consensus document. This approach is good for robustness, but
bad for performance: since they don&#39;t know any bandwidths, they
end up choosing at random rather than weighting their choice by
speed. Fixed by the above feature of putting bandwidths in the
consensus.</li>
</ul>

<p><strong>Major bugfixes (relays):</strong></p>

<ul>
<li>Relays were falling out of the networkstatus consensus for
part of a day if they changed their local config but the
authorities discarded their new descriptor as &quot;not sufficiently
different&quot;. Now directory authorities accept a descriptor as changed
if BandwidthRate or BandwidthBurst changed. Partial fix for bug 962;
patch by Sebastian.</li>
<li>Ensure that two circuits can never exist on the same connection
with the same circuit ID, even if one is marked for close. This
is conceivably a bugfix for bug 779; fixes a bug on 0.1.0.4-rc.</li>
<li>Directory authorities were neglecting to mark relays down in their
internal histories if the relays fall off the routerlist without
ever being found unreachable. So there were relays in the histories
that haven&#39;t been seen for eight months, and are listed as being
up for eight months. This wreaked havoc on the &quot;median wfu&quot; and
&quot;median mtbf&quot; calculations, in turn making Guard and Stable flags
wrong, hurting network performance. Fixes bugs 696 and 969. Bugfix
on 0.2.0.6-alpha.</li>
</ul>

<p><strong>Major bugfixes (hidden services):</strong></p>

<ul>
<li>When establishing a hidden service, introduction points that
originate from cannibalized circuits were completely ignored
and not included in rendezvous service descriptors. This might
have been another reason for delay in making a hidden service
available. Bugfix from long ago (0.0.9.x?)</li>
</ul>

<p><strong>Major bugfixes (memory and resource management):</strong></p>

<ul>
<li>Fixed some memory leaks -- some quite frequent, some almost
impossible to trigger -- based on results from Coverity.</li>
<li>Speed up parsing and cut down on memory fragmentation by using
stack-style allocations for parsing directory objects. Previously,
this accounted for over 40% of allocations from within Tor&#39;s code
on a typical directory cache.</li>
<li>Use a Bloom filter rather than a digest-based set to track which
descriptors we need to keep around when we&#39;re cleaning out old
router descriptors. This speeds up the computation significantly,
and may reduce fragmentation.</li>
</ul>

<p><strong>New/changed config options:</strong></p>

<ul>
<li>Now NodeFamily and MyFamily config options allow spaces in
identity fingerprints, so it&#39;s easier to paste them in.
Suggested by Lucky Green.</li>
<li>Allow ports 465 and 587 in the default exit policy again. We had
rejected them in 0.1.0.15, because back in 2005 they were commonly
misconfigured and ended up as spam targets. We hear they are better
locked down these days.</li>
<li>Make TrackHostExit mappings expire a while after their last use, not
after their creation. Patch from Robert Hogan.</li>
<li>Add an ExcludeExitNodes option so users can list a set of nodes
that should be be excluded from the exit node position, but
allowed elsewhere. Implements proposal 151.</li>
<li>New --hush command-line option similar to --quiet. While --quiet
disables all logging to the console on startup, --hush limits the
output to messages of warning and error severity.</li>
<li>New configure/torrc options (--enable-geoip-stats,
DirRecordUsageByCountry) to record how many IPs we&#39;ve served
directory info to in each country code, how many status documents
total we&#39;ve sent to each country code, and what share of the total
directory requests we should expect to see.</li>
<li>Make outbound DNS packets respect the OutboundBindAddress setting.
Fixes the bug part of bug 798. Bugfix on 0.1.2.2-alpha.</li>
<li>Allow separate log levels to be configured for different logging
domains. For example, this allows one to log all notices, warnings,
or errors, plus all memory management messages of level debug or
higher, with: Log [MM] debug-err [*] notice-err file /var/log/tor.</li>
<li>Update to the &quot;June 3 2009&quot; ip-to-country file.</li>
</ul>

<p><strong>Minor features (relays):</strong></p>

<ul>
<li>Raise the minimum rate limiting to be a relay from 20000 bytes
to 20480 bytes (aka 20KB/s), to match our documentation. Also
update directory authorities so they always assign the Fast flag
to relays with 20KB/s of capacity. Now people running relays won&#39;t
suddenly find themselves not seeing any use, if the network gets
faster on average.</li>
<li>If we&#39;re a relay and we change our IP address, be more verbose
about the reason that made us change. Should help track down
further bugs for relays on dynamic IP addresses.</li>
<li>Exit servers can now answer resolve requests for ip6.arpa addresses.</li>
<li>Implement most of Proposal 152: allow specialized servers to permit
single-hop circuits, and clients to use those servers to build
single-hop circuits when using a specialized controller. Patch
from Josh Albrecht. Resolves feature request 768.</li>
<li>When relays do their initial bandwidth measurement, don&#39;t limit
to just our entry guards for the test circuits. Otherwise we tend
to have multiple test circuits going through a single entry guard,
which makes our bandwidth test less accurate. Fixes part of bug 654;
patch contributed by Josh Albrecht.</li>
</ul>

<p><strong>Minor features (directory authorities):</strong></p>

<ul>
<li>Try not to open more than one descriptor-downloading connection
to an authority at once. This should reduce load on directory
authorities. Fixes bug 366.</li>
<li>Add cross-certification to newly generated certificates, so that
a signing key is enough information to look up a certificate. Start
serving certificates by
pairs. Implements proposal 157.</li>
<li>When a directory authority downloads a descriptor that it then
immediately rejects, do not retry downloading it right away. Should
save some bandwidth on authorities. Fix for bug 888. Patch by
Sebastian Hahn.</li>
<li>Directory authorities now serve a /tor/dbg-stability.txt URL to
help debug WFU and MTBF calculations.</li>
<li>In directory authorities&#39; approved-routers files, allow
fingerprints with or without space.</li>
</ul>

<p><strong>Minor features (directory mirrors):</strong></p>

<ul>
<li>When a download gets us zero good descriptors, do not notify
Tor that new directory information has arrived.</li>
<li>Servers support a new URL scheme for consensus downloads that
allows the client to specify which authorities are trusted.
The server then only sends the consensus if the client will trust
it. Otherwise a 404 error is sent back. Clients use this
new scheme when the server supports it (meaning it&#39;s running
0.2.1.1-alpha or later). Implements proposal 134.</li>
</ul>

<p><strong>Minor features (bridges):</strong></p>

<ul>
<li>If the bridge config line doesn&#39;t specify a port, assume 443.
This makes bridge lines a bit smaller and easier for users to
understand.</li>
<li>If we&#39;re using bridges and our network goes away, be more willing
to forgive our bridges and try again when we get an application
request.</li>
</ul>

<p><strong>Minor features (hidden services):</strong></p>

<ul>
<li>When the client launches an introduction circuit, retry with a
new circuit after 30 seconds rather than 60 seconds.</li>
<li>Launch a second client-side introduction circuit in parallel
after a delay of 15 seconds (based on work by Christian Wilms).</li>
<li>Hidden services start out building five intro circuits rather
than three, and when the first three finish they publish a service
descriptor using those. Now we publish our service descriptor much
faster after restart.</li>
<li>Drop the requirement to have an open dir port for storing and
serving v2 hidden service descriptors.</li>
</ul>

<p><strong>Minor features (build and packaging):</strong></p>

<ul>
<li>On Linux, use the prctl call to re-enable core dumps when the User
option is set.</li>
<li>Try to make sure that the version of Libevent we&#39;re running with
is binary-compatible with the one we built with. May address bug
897 and others.</li>
<li>Add a new --enable-local-appdata configuration switch to change
the default location of the datadir on win32 from APPDATA to
LOCAL_APPDATA. In the future, we should migrate to LOCAL_APPDATA
entirely. Patch from coderman.</li>
<li>Build correctly against versions of OpenSSL 0.9.8 or later that
are built without support for deprecated functions.</li>
<li>On platforms with a maximum syslog string length, truncate syslog
messages to that length ourselves, rather than relying on the
system to do it for us.</li>
<li>Automatically detect MacOSX versions earlier than 10.4.0, and
disable kqueue from inside Tor when running with these versions.
We previously did this from the startup script, but that was no
help to people who didn&#39;t use the startup script. Resolves bug 863.</li>
<li>Build correctly when configured to build outside the main source
path. Patch from Michael Gold.</li>
<li>Disable GCC&#39;s strict alias optimization by default, to avoid the
likelihood of its introducing subtle bugs whenever our code violates
the letter of C99&#39;s alias rules.</li>
<li>Change the contrib/tor.logrotate script so it makes the new
logs as &quot;_tor:_tor&quot; rather than the default, which is generally
&quot;root:wheel&quot;. Fixes bug 676, reported by Serge Koksharov.</li>
<li>Change our header file guard macros to be less likely to conflict
with system headers. Adam Langley noticed that we were conflicting
with log.h on Android.</li>
<li>Add a couple of extra warnings to --enable-gcc-warnings for GCC 4.3,
and stop using a warning that had become unfixably verbose under
GCC 4.3.</li>
<li>Use a lockfile to make sure that two Tor processes are not
simultaneously running with the same datadir.</li>
<li>Allow OpenSSL to use dynamic locks if it wants.</li>
<li>Add LIBS=-lrt to Makefile.am so the Tor RPMs use a static libevent.</li>
</ul>

<p><strong>Minor features (controllers):</strong></p>

<ul>
<li>When generating circuit events with verbose nicknames for
controllers, try harder to look up nicknames for routers on a
circuit. (Previously, we would look in the router descriptors we had
for nicknames, but not in the consensus.) Partial fix for bug 941.</li>
<li>New controller event NEWCONSENSUS that lists the networkstatus
lines for every recommended relay. Now controllers like Torflow
can keep up-to-date on which relays they should be using.</li>
<li>New controller event &quot;clients_seen&quot; to report a geoip-based summary
of which countries we&#39;ve seen clients from recently. Now controllers
like Vidalia can show bridge operators that they&#39;re actually making
a difference.</li>
<li>Add a &#39;getinfo status/clients-seen&#39; controller command, in case
controllers want to hear clients_seen events but connect late.</li>
<li>New CONSENSUS_ARRIVED event to note when a new consensus has
been fetched and validated.</li>
<li>Add an internal-use-only __ReloadTorrcOnSIGHUP option for
controllers to prevent SIGHUP from reloading the configuration.
Fixes bug 856.</li>
<li>Return circuit purposes in response to GETINFO circuit-status.
Fixes bug 858.</li>
<li>Serve the latest v3 networkstatus consensus via the control
port. Use &quot;getinfo dir/status-vote/current/consensus&quot; to fetch it.</li>
<li>Add a &quot;GETINFO /status/bootstrap-phase&quot; controller option, so the
controller can query our current bootstrap state in case it attaches
partway through and wants to catch up.</li>
<li>Provide circuit purposes along with circuit events to the controller.</li>
</ul>

<p><strong>Minor features (tools):</strong></p>

<ul>
<li>Do not have tor-resolve automatically refuse all .onion addresses;
if AutomapHostsOnResolve is set in your torrc, this will work fine.</li>
<li>Add a -p option to tor-resolve for specifying the SOCKS port: some
people find host:port too confusing.</li>
<li>Print the SOCKS5 error message string as well as the error code
when a tor-resolve request fails. Patch from Jacob.</li>
</ul>

<p><strong>Minor bugfixes (memory and resource management):</strong></p>

<ul>
<li>Clients no longer cache certificates for authorities they do not
recognize. Bugfix on 0.2.0.9-alpha.</li>
<li>Do not use C&#39;s stdio library for writing to log files. This will
improve logging performance by a minute amount, and will stop
leaking fds when our disk is full. Fixes bug 861.</li>
<li>Stop erroneous use of O_APPEND in cases where we did not in fact
want to re-seek to the end of a file before every last write().</li>
<li>Fix a small alignment and memory-wasting bug on buffer chunks.
Spotted by rovv.</li>
<li>Add a malloc_good_size implementation to OpenBSD_malloc_linux.c,
to avoid unused RAM in buffer chunks and memory pools.</li>
<li>Reduce the default smartlist size from 32 to 16; it turns out that
most smartlists hold around 8-12 elements tops.</li>
<li>Make dumpstats() log the fullness and size of openssl-internal
buffers.</li>
<li>If the user has applied the experimental SSL_MODE_RELEASE_BUFFERS
patch to their OpenSSL, turn it on to save memory on servers. This
patch will (with any luck) get included in a mainline distribution
before too long.</li>
<li>Fix a memory leak when v3 directory authorities load their keys
and cert from disk. Bugfix on 0.2.0.1-alpha.</li>
<li>Stop using malloc_usable_size() to use more area than we had
actually allocated: it was safe, but made valgrind really unhappy.</li>
<li>Make the assert_circuit_ok() function work correctly on circuits that
have already been marked for close.</li>
<li>Fix uninitialized size field for memory area allocation: may improve
memory performance during directory parsing.</li>
</ul>

<p><strong>Minor bugfixes (clients):</strong></p>

<ul>
<li>Stop reloading the router list from disk for no reason when we
run out of reachable directory mirrors. Once upon a time reloading
it would set the &#39;is_running&#39; flag back to 1 for them. It hasn&#39;t
done that for a long time.</li>
<li>When we had picked an exit node for a connection, but marked it as
&quot;optional&quot;, and it turned out we had no onion key for the exit,
stop wanting that exit and try again. This situation may not
be possible now, but will probably become feasible with proposal

<ol>
<li>Spotted by rovv. Fixes another case of bug 752.</li>
</ol></li>
<li>Fix a bug in address parsing that was preventing bridges or hidden
service targets from being at IPv6 addresses.</li>
<li>Do not remove routers as too old if we do not have any consensus
document. Bugfix on 0.2.0.7-alpha.</li>
<li>When an exit relay resolves a stream address to a local IP address,
do not just keep retrying that same exit relay over and
over. Instead, just close the stream. Addresses bug 872. Bugfix
on 0.2.0.32. Patch from rovv.</li>
<li>Made Tor a little less aggressive about deleting expired
certificates. Partial fix for bug 854.</li>
<li>Treat duplicate certificate fetches as failures, so that we do
not try to re-fetch an expired certificate over and over and over.</li>
<li>Do not say we&#39;re fetching a certificate when we&#39;ll in fact skip it
because of a pending download.</li>
<li>If we have correct permissions on $datadir, we complain to stdout
and fail to start. But dangerous permissions on
$datadir/cached-status/ would cause us to open a log and complain
there. Now complain to stdout and fail to start in both cases. Fixes
bug 820, reported by seeess.</li>
</ul>

<p><strong>Minor bugfixes (bridges):</strong></p>

<ul>
<li>When we made bridge authorities stop serving bridge descriptors over
unencrypted links, we also broke DirPort reachability testing for
bridges. So bridges with a non-zero DirPort were printing spurious
warns to their logs. Bugfix on 0.2.0.16-alpha. Fixes bug 709.</li>
<li>Don&#39;t allow a bridge to publish its router descriptor to a
non-bridge directory authority. Fixes part of bug 932.</li>
<li>When we change to or from being a bridge, reset our counts of
client usage by country. Fixes bug 932.</li>
</ul>

<p><strong>Minor bugfixes (relays):</strong></p>

<ul>
<li>Log correct error messages for DNS-related network errors on
Windows.</li>
<li>Actually return -1 in the error case for read_bandwidth_usage().
Harmless bug, since we currently don&#39;t care about the return value
anywhere. Bugfix on 0.2.0.9-alpha.</li>
<li>Provide a more useful log message if bug 977 (related to buffer
freelists) ever reappears, and do not crash right away.</li>
<li>We were already rejecting relay begin cells with destination port
of 0. Now also reject extend cells with destination port or address
of 0. Suggested by lark.</li>
<li>When we can&#39;t transmit a DNS request due to a network error, retry
it after a while, and eventually transmit a failing response to
the RESOLVED cell. Bugfix on 0.1.2.5-alpha.</li>
<li>Solve a bug that kept hardware crypto acceleration from getting
enabled when accounting was turned on. Fixes bug 907. Bugfix on
0.0.9pre6.</li>
<li>When a canonical connection appears later in our internal list
than a noncanonical one for a given OR ID, always use the
canonical one. Bugfix on 0.2.0.12-alpha. Fixes bug 805.
Spotted by rovv.</li>
<li>Avoid some nasty corner cases in the logic for marking connections
as too old or obsolete or noncanonical for circuits. Partial
bugfix on bug 891.</li>
<li>Fix another interesting corner-case of bug 891 spotted by rovv:
Previously, if two hosts had different amounts of clock drift, and
one of them created a new connection with just the wrong timing,
the other might decide to deprecate the new connection erroneously.
Bugfix on 0.1.1.13-alpha.</li>
<li>If one win32 nameserver fails to get added, continue adding the
rest, and don&#39;t automatically fail.</li>
<li>Fix a bug where an unreachable relay would establish enough
reachability testing circuits to do a bandwidth test -- if
we already have a connection to the middle hop of the testing
circuit, then it could establish the last hop by using the existing
connection. Bugfix on 0.1.2.2-alpha, exposed when we made testing
circuits no longer use entry guards in 0.2.1.3-alpha.</li>
</ul>

<p><strong>Minor bugfixes (directory authorities):</strong></p>

<ul>
<li>Limit uploaded directory documents to be 16M rather than 500K.
The directory authorities were refusing v3 consensus votes from
other authorities, since the votes are now 504K. Fixes bug 959;
bugfix on 0.0.2pre17 (where we raised it from 50K to 500K ;) .</li>
<li>Directory authorities should never send a 503 &quot;busy&quot; response to
requests for votes or keys. Bugfix on 0.2.0.8-alpha; exposed by
bug 959.</li>
<li>Fix code so authorities _actually_ send back X-Descriptor-Not-New
headers. Bugfix on 0.2.0.10-alpha.</li>
</ul>

<p><strong>Minor bugfixes (hidden services):</strong></p>

<ul>
<li>When we can&#39;t find an intro key for a v2 hidden service descriptor,
fall back to the v0 hidden service descriptor and log a bug message.
Workaround for bug 1024.</li>
<li>In very rare situations new hidden service descriptors were
published earlier than 30 seconds after the last change to the
service. (We currently think that a hidden service descriptor
that&#39;s been stable for 30 seconds is worth publishing.)</li>
<li>If a hidden service sends us an END cell, do not consider
retrying the connection; just close it. Patch from rovv.</li>
<li>If we are not using BEGIN_DIR cells, don&#39;t attempt to contact hidden
service directories if they have no advertised dir port. Bugfix
on 0.2.0.10-alpha.</li>
</ul>

<p><strong>Minor bugfixes (tools):</strong></p>

<ul>
<li>In the torify(1) manpage, mention that tsocks will leak your
DNS requests.</li>
</ul>

<p><strong>Minor bugfixes (controllers):</strong></p>

<ul>
<li>If the controller claimed responsibility for a stream, but that
stream never finished making its connection, it would live
forever in circuit_wait state. Now we close it after SocksTimeout
seconds. Bugfix on 0.1.2.7-alpha; reported by Mike Perry.</li>
<li>Make DNS resolved controller events into &quot;CLOSED&quot;, not
&quot;FAILED&quot;. Bugfix on 0.1.2.5-alpha. Fix by Robert Hogan. Resolves
bug 807.</li>
<li>The control port would close the connection before flushing long
replies, such as the network consensus, if a QUIT command was issued
before the reply had completed. Now, the control port flushes all
pending replies before closing the connection. Also fix a spurious
warning when a QUIT command is issued after a malformed or rejected
AUTHENTICATE command, but before the connection was closed. Patch
by Marcus Griep. Fixes bugs 1015 and 1016.</li>
<li>Fix a bug that made stream bandwidth get misreported to the
controller.</li>
</ul>

<p><strong>Deprecated and removed features:</strong></p>

<ul>
<li>The old &quot;tor --version --version&quot; command, which would print out
the subversion &quot;Id&quot; of most of the source files, is now removed. It
turned out to be less useful than we&#39;d expected, and harder to
maintain.</li>
<li>RedirectExits has been removed. It was deprecated since
0.2.0.3-alpha.</li>
<li>Finally remove deprecated &quot;EXTENDED_FORMAT&quot; controller feature. It
has been called EXTENDED_EVENTS since 0.1.2.4-alpha.</li>
<li>Cell pools are now always enabled; --disable-cell-pools is ignored.</li>
<li>Directory mirrors no longer fetch the v1 directory or
running-routers files. They are obsolete, and nobody asks for them
anymore. This is the first step to making v1 authorities obsolete.</li>
<li>Take out the TestVia config option, since it was a workaround for
a bug that was fixed in Tor 0.1.1.21.</li>
<li>Mark RendNodes, RendExcludeNodes, HiddenServiceNodes, and
HiddenServiceExcludeNodes as obsolete: they never worked properly,
and nobody seems to be using them. Fixes bug 754. Bugfix on
0.1.0.1-rc. Patch from Christian Wilms.</li>
<li>Remove all backward-compatibility code for relays running
versions of Tor so old that they no longer work at all on the
Tor network.</li>
</ul>

<p><strong>Code simplifications and refactoring:</strong></p>

<ul>
<li>Tool-assisted documentation cleanup. Nearly every function or
static variable in Tor should have its own documentation now.</li>
<li>Rename the confusing or_is_obsolete field to the more appropriate
is_bad_for_new_circs, and move it to or_connection_t where it
belongs.</li>
<li>Move edge-only flags from connection_t to edge_connection_t: not
only is this better coding, but on machines of plausible alignment,
it should save 4-8 bytes per connection_t. &quot;Every little bit helps.&quot;</li>
<li>Rename ServerDNSAllowBrokenResolvConf to ServerDNSAllowBrokenConfig
for consistency; keep old option working for backward compatibility.</li>
<li>Simplify the code for finding connections to use for a circuit.</li>
<li>Revise the connection_new functions so that a more typesafe variant
exists. This will work better with Coverity, and let us find any
actual mistakes we&#39;re making here.</li>
<li>Refactor unit testing logic so that dmalloc can be used sensibly
with unit tests to check for memory leaks.</li>
<li>Move all hidden-service related fields from connection and circuit
structure to substructures: this way they won&#39;t eat so much memory.</li>
<li>Squeeze 2-5% out of client performance (according to oprofile) by
improving the implementation of some policy-manipulation functions.</li>
<li>Change the implementation of ExcludeNodes and ExcludeExitNodes to
be more efficient. Formerly it was quadratic in the number of
servers; now it should be linear. Fixes bug 509.</li>
<li>Save 16-22 bytes per open circuit by moving the n_addr, n_port,
and n_conn_id_digest fields into a separate structure that&#39;s
only needed when the circuit has not yet attached to an n_conn.</li>
<li>Optimize out calls to time(NULL) that occur for every IO operation,
or for every cell. On systems like Windows where time() is a
slow syscall, this fix will be slightly helpful.</li>
</ul>

  </article>

  <div class="post-footer">
      <a class="post-blog" href="">phobos's Blog</a>
  </div>
  <br />

</div>

<!-- Include the side column --->
<div class="sidecol">

<!-- RSS FEED / SEARCH -->
    <div class="sidefirst">
	<a href="/feed.xml"><img src="/assets/images/rss.png">RSS</a>
	<!-- <a href="#"><img src="/img/rss.png">Atom</a> -->
	<form>
        <input class="searchtext" type="text" size="10" maxlength="10"><input class="searchbutton" type="submit" value="Search">
        </form>
    </div>

<!-- EVENTS -->
    <div class ="sidebox orangebox">
	<h2>Upcoming Events</h2>
	<ul>
	    
		    <li><span><a href="/events/andrew-keynotes-broadband-world-forum">Andrew Keynotes Broadband World Forum</a></span></li>
	    
		    <li><span><a href="/events/roger-usenix-security-symposium-san-diego-ca">Roger @ Usenix Security Symposium, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/roger-foci-%E2%80%9914-san-diego-ca">Roger @ FOCI ’14, San Diego, CA</a></span></li>
	    
		    <li><span><a href="/events/tor-pets-2014-amsterdam">Tor @ PETS 2014, Amsterdam</a></span></li>
	    
	</ul>
	<span><a href="/events">full calendar &raquo;</a></span>
    </div>
    
<!-- RECENT BLOG POSTS -->
    <div class ="sidebox greenbox">
	<h2>Recent Blog Posts</h2>
	<ul>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-8th-2014">Tor Weekly News — October 8th, 2014</a></span></li>
	  
		    <li><span><a href="/closer-look-great-firewall-china">A closer look at the Great Firewall of China</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-october-1st-2014">Tor Weekly News — October 1st, 2014</a></span></li>
	  
		    <li><span><a href="/tor-browser-40-alpha-3-released">Tor Browser 4.0-alpha-3 is released</a></span></li>
	  
		    <li><span><a href="/tor-browser-366-released">Tor Browser 3.6.6 is released</a></span></li>
	  
		    <li><span><a href="/tails-112-out">Tails 1.1.2 is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-24th-2014">Tor Weekly News — September 24th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-17th-2014">Tor Weekly News — September 17th, 2014</a></span></li>
	  
		    <li><span><a href="/tor-0257-rc-out">Tor 0.2.5.7-rc is out</a></span></li>
	  
		    <li><span><a href="/tor-weekly-news-%E2%80%94-september-10th-2014">Tor Weekly News — September 10th, 2014</a></span></li>
	  
	</ul>
	<span><a href="/">more &raquo;</a></span>
    </div>
    
<!-- TAG CLOUD -->
    <div class ="tagbox orangebox">
	<h2>Blog Tag Cloud</h2>
	<ul>

    <li style="font-size: 57%">
        <span><a href="/tag/blog/">
            blog
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/first post/">
            first post
        </a></span>
    </li>

    <li style="font-size: 171%">
        <span><a href="/tag/tor/">
            tor
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/24c3/">
            24c3
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/ccc/">
            ccc
        </a></span>
    </li>

    <li style="font-size: 61%">
        <span><a href="/tag/talks/">
            talks
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/bugs/">
            bugs
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/crashes/">
            crashes
        </a></span>
    </li>

    <li style="font-size: 64%">
        <span><a href="/tag/osx/">
            osx
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/qt/">
            qt
        </a></span>
    </li>

    <li style="font-size: 86%">
        <span><a href="/tag/vidalia/">
            vidalia
        </a></span>
    </li>

    <li style="font-size: 68%">
        <span><a href="/tag/vidalia bundle/">
            vidalia bundle
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/meetup/">
            meetup
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/attacks/">
            attacks
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/covert channels/">
            covert channels
        </a></span>
    </li>

    <li style="font-size: 57%">
        <span><a href="/tag/media coverage/">
            media coverage
        </a></span>
    </li>

    <li style="font-size: 88%">
        <span><a href="/tag/bridges/">
            bridges
        </a></span>
    </li>

    <li style="font-size: 59%">
        <span><a href="/tag/incognito/">
            incognito
        </a></span>
    </li>

    <li style="font-size: 116%">
        <span><a href="/tag/progress report/">
            progress report
        </a></span>
    </li>

    <li style="font-size: 83%">
        <span><a href="/tag/torbrowser/">
            torbrowser
        </a></span>
    </li>

    <li style="font-size: 85%">
        <span><a href="/tag/torbutton/">
            torbutton
        </a></span>
    </li>

    <li style="font-size: 65%">
        <span><a href="/tag/china/">
            china
        </a></span>
    </li>

    <li style="font-size: 56%">
        <span><a href="/tag/directors/">
            directors
        </a></span>
    </li>

    <li style="font-size: 76%">
        <span><a href="/tag/release candidate/">
            release candidate
        </a></span>
    </li>

    <li style="font-size: 74%">
        <span><a href="/tag/gsoc/">
            gsoc
        </a></span>
    </li>

	</ul>
	<span><a href="/tag-cloud">more tags &raquo;</a></span>
    </div>

</div>

<div style="clear: both;"></div>  


<!-- COMMENTS -->
<div id="comments" class="comments clearfix">
  <div class="comments-loading">
  <p><em>Enable Javascript to view comments</em></p>
  </div>
</div>

<script type="text/javascript" class="juvia">
(function() {
    var loadingSection = document.body.querySelector('.comments-loading');
    var icon = '<p>Comments Loading...</p><img alt="loading comments" src="/assets/images/comments-loading.gif">';

    loadingSection.innerHTML = loadingSection.innerHTML + icon;

    var options = {
        container    : '.comments',
        site_key     : 'im3x57usjcg72fkm6lyqzwzt7vaoi4g',
        topic_key    : '/blog/tor-02118-and-02119-released-stable',
        topic_url    : location.href,
        topic_title  : document.title || location.href,
        include_base : !window.Juvia,
        include_css  : !window.Juvia,
        comment_order: 'latest-first'
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://torblog-juvia-4525.herokuapp.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);

    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0] && commentsLoaded).appendChild(s);

})();
</script>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">The Tor Project Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>The Tor Project Blog</li>
          <li><a href="mailto:contact@torproject.org">contact@torproject.org</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jekyll</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
